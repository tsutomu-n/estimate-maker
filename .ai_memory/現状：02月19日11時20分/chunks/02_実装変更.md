# 02_実装変更

## 分かったこと
- 実装は `loadFromJSON` 系で互換値を吸収するよう更新済み。
- `LineItem.fromJSON`: `unitPrice` → `unitPriceExclTax` → `amountExclTax/quantity` の優先で `unitPrice` を補完。
- `Estimate.loadFromJSON`: `discount` 不在時に `discountExclTax` を補完。

## 技術要素
- 既存 UI 計算式は `unitPrice` ベース。
- strict schema では追加キー禁止のため、ドキュメントでどの形式を受け付けるか分離必要。

## 決定事項
- サンプルとしての厳密整合を重視し、`標準プラン.json` / `sample_738man.json` を strict寄せで維持する。

## 未解決点
- `sample_738man.json` の最終内容が HEAD 上で strict かつ compat どちらかを検証コマンド未実行。
- 変更履歴の commit 反映は未実施。

## 検証手順
1. `npx -y ajv-cli validate -s docs/estimate-json.schema.json -d static/samples/標準プラン.json`
2. `npx -y ajv-cli validate -s docs/estimate-json.compat.schema.json -d static/samples/sample_738man.json`

## 関連ファイル
- src/lib/core/models/LineItem.svelte.ts
- src/lib/core/models/Estimate.svelte.ts
- static/samples/sample_738man.json
