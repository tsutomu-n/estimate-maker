# 01_要件と意図

## 分かったこと
- ユーザーは見積JSONのスキーマ整合（strict/compat）とサンプル整備を進め、第三者向け説明文書を増やす要求を繰り返した。
- `標準プラン.json` が単価0表示の原因として互換フィールド依存が疑われた。
- `sample_738man.json` が見積データではなく別schema定義だったため、表示不整合に繋がる可能性が高い。

## 技術要素
- strict想定: `unitPrice` + `discount` を必須とする。
- compat想定: `unitPriceExclTax`/`amountExclTax`/`discountExclTax` を吸収して変換する実装。
- additionalProperties false による余剰キー禁止。

## 決定事項
- strict推奨運用を前提に docs を分離記載する。
- sample_738man を strict形式で再構成する。

## 未解決点
- 本番投入時の自動検証（ajv CI連携）は未導入。
- `strict` と `compat` のどちらをUI側で受け口として常設するかは運用方針次第。

## 検証手順
- `npx -y ajv-cli validate -s docs/estimate-json.schema.json -d static/samples/標準プラン.json`
- `npx -y ajv-cli validate -s docs/estimate-json.compat.schema.json -d static/samples/sample_738man.json`

## 関連ファイル
- docs/estimate-json.schema.json
- docs/estimate-json.compat.schema.json
- docs/estimate-json-schema.md
- docs/estimate-json-guide-recommended.md
- docs/estimate-json-guide-junior-se.md
- src/lib/core/models/Estimate.svelte.ts
- src/lib/core/models/LineItem.svelte.ts
- static/samples/標準プラン.json
- static/samples/sample_738man.json
